from: maven:3-alpine
services:
  - mysql:
      from: mysql:5.7
      env:
        - MYSQL_ROOT_PASSWORD=rtt
        - MYSQL_DATABASE=rtt
        - MYSQL_USER=rtt
        - MYSQL_PASSWORD=rtt
      restart: always
env:
  - DB_TEST_ADDRESS=mysql
  - MAVEN_CONFIG=/var/maven/.m2
  - MAVEN_OPTS=-Duser.home=/var/maven

volumes:
  - /tmp/.m2:/var/maven/.m2

before: mvn dependency:resolve -q

tasks:
  env: env | sort
  test: mvn test
  shell: /bin/bash
  doc:
    disable: '*'
    cmd: mvn javadoc:javadoc
  jar:
    disable: '*'
    cmd: mvn package -DskipTests=true -Dmaven.javadoc.skip=true
